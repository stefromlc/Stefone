<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Primary Meta Tags -->
<title>SpendScope â€“ Track Recurring Spending Over Time</title>
<meta name="title" content="SpendScope â€“ Track Recurring Spending Over Time" />
<meta name="description" content="Track recurring spending and see how small habits compound over days, months, and years. Explore long-term wealth potential and goals." />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.stefone.com/spendscope/" />
<meta property="og:title" content="SpendScope â€“ Track Recurring Spending Over Time" />
<meta property="og:description" content="Track recurring spending and see how small habits compound over days, months, and years. Explore long-term wealth potential and goals." />
<meta property="og:image" content="https://www.stefone.com/assets/thumbs/spendscope.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="SpendScope recurring spending and wealth visualization preview" />

<!-- Twitter / X -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="SpendScope â€“ Track Recurring Spending Over Time" />
<meta name="twitter:description" content="Track recurring spending and see how small habits compound over days, months, and years. Explore long-term wealth potential and goals." />
<meta name="twitter:image" content="https://www.stefone.com/assets/thumbs/spendscope.png" />

<!-- Optional -->
<meta name="theme-color" content="#6366f1" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    screens: {
                        'xs': '475px',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1)',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1)',
                        'blob': 'blob 10s infinite',
                        'confetti': 'confetti 2s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        confetti: {
                            '0%': { transform: 'translateY(0) rotate(0)', opacity: '1' },
                            '100%': { transform: 'translateY(100px) rotate(720deg)', opacity: '0' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- HTML2Canvas for Image Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(99, 102, 241, 0.3); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(99, 102, 241, 0.5); }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: rgba(99, 102, 241, 0.6); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none;  scrollbar-width: none; }

        input[type="range"] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            margin-top: -8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            border: 2px solid rgba(0,0,0,0.05);
        }
        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: transparent;
            border-radius: 2px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
        }
        
        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.3);
        }

        .product-image {
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .group:hover .product-image {
            transform: scale(1.1);
        }

        .impact-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%);
        }

        .glass-badge {
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.10);
            -webkit-backdrop-filter: blur(18px) saturate(160%);
            backdrop-filter: blur(18px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, 0.22);
            border-top-color: rgba(255, 255, 255, 0.35);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.18);
        }

        .glass-badge::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.35) 0%, rgba(255, 255, 255, 0.10) 25%, rgba(255, 255, 255, 0.00) 60%);
            opacity: 0.55;
            pointer-events: none;
        }

        .dark .glass-badge {
            background: rgba(15, 23, 42, 0.10);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-top-color: rgba(255, 255, 255, 0.28);
        }
        
        /* Pattern for Share Card - CSS Only to avoid CORS */
        .share-pattern {
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
        }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900 transition-colors duration-500 selection:bg-indigo-500 selection:text-white overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useLayoutEffect } = React;

        // Enhanced Icon Set
        const Icons = {
            ArrowLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14M5 12h14"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Moon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            TrendingUp: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Layers: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>,
            PieChart: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10Z"/></svg>,
            Target: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Share2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            BarChart2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
            Copy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
            Image: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Link: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Twitter: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>,
            MessageCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>,
            Mail: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>,
            Smartphone: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>,
            Linkedin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>,
            Facebook: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.791-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>,
            Reddit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>,
        };

        const CURRENCIES = {
            GBP: { symbol: 'Â£', rate: 0.79, locale: 'en-GB' },
            USD: { symbol: '$', rate: 1.0, locale: 'en-US' },
            EUR: { symbol: 'â‚¬', rate: 0.92, locale: 'de-DE' },
        };

        const PERIODS = {
            day: { label: 'Day', multiplier: 365 },
            week: { label: 'Week', multiplier: 52 },
            month: { label: 'Month', multiplier: 12 },
        };

        const CATEGORIES = {
            Food: { color: 'text-amber-500', bg: 'bg-amber-500', icon: 'ðŸ”' },
            Subscriptions: { color: 'text-blue-500', bg: 'bg-blue-500', icon: 'ðŸ“º' },
            Transport: { color: 'text-cyan-500', bg: 'bg-cyan-500', icon: 'ðŸš•' },
            Social: { color: 'text-purple-500', bg: 'bg-purple-500', icon: 'ðŸ¥‚' },
            Health: { color: 'text-emerald-500', bg: 'bg-emerald-500', icon: 'ðŸ’ª' },
            Other: { color: 'text-slate-500', bg: 'bg-slate-500', icon: 'ðŸ“¦' }
        };

        const GOAL_PRESETS = [
            { name: 'Dream Wedding', url: 'https://images.unsplash.com/photo-1519741497674-611481863552?auto=format&fit=crop&w=600&q=80' },
            { name: 'Dream Home', url: 'https://mhstaintonhomes.co.uk/wp-content/uploads/2024/06/Parklands-1-1024x682.jpg' },
            { name: 'New Car', url: 'https://www.group1auto.co.uk/media/kedprttl/components-featured-block-content-1000x562-desktop-bmw-x6-2023-1.jpg?format=webp&v=1da1c933bc6b760' },
            { name: 'Travel', url: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=600&q=80' },
            { name: 'Tech Upgrade', url: 'https://images.unsplash.com/photo-1550009158-9ebf69173e03?auto=format&fit=crop&w=600&q=80' },
            { name: 'Emergency Fund', url: 'https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?auto=format&fit=crop&w=600&q=80' },
            { name: 'Renovation', url: 'https://i.pinimg.com/originals/36/20/54/36205479901bd8220bc736e93d578966.jpg' },
            { name: 'Investment', url: 'https://res.cloudinary.com/jerrick/image/upload/d_642250b563292b35f27461a7.png,f_jpg,fl_progressive,q_auto,w_1024/64c343ec418f46001dda0ac1.jpg' }
        ];

        const PRESETS = [
            { name: 'Meal Deal', cost: 3.40, frequency: 5, period: 'week', icon: 'ðŸ¥ª', category: 'Food' },
            { name: 'Fancy Coffee', cost: 3.80, frequency: 1, period: 'day', icon: 'â˜•ï¸', category: 'Food' },
            { name: 'Disposable Vape', cost: 6.00, frequency: 2, period: 'week', icon: 'ðŸ’¨', category: 'Other' },
            { name: 'Pack of Cigs', cost: 16.50, frequency: 1, period: 'day', icon: 'ðŸš¬', category: 'Other' },
            { name: 'Pint of Lager', cost: 6.50, frequency: 2, period: 'week', icon: 'ðŸº', category: 'Social' },
            { name: 'Takeaway', cost: 14.00, frequency: 2, period: 'week', icon: 'ðŸ”', category: 'Food' },
            { name: 'Avocado Brunch', cost: 16.00, frequency: 1, period: 'week', icon: 'ðŸ¥‘', category: 'Food' },
            { name: 'Gym Membership', cost: 35.00, frequency: 1, period: 'month', icon: 'ðŸ‹ï¸', category: 'Health' },
            { name: 'Lottery Tickets', cost: 6.00, frequency: 1, period: 'week', icon: 'ðŸŽŸï¸', category: 'Other' },
            { name: 'Taxi / Uber', cost: 20.00, frequency: 2, period: 'week', icon: 'ðŸš•', category: 'Transport' },
            { name: 'Streaming Service', cost: 15.00, frequency: 1, period: 'month', icon: 'ðŸ“º', category: 'Subscriptions' },
        ];

        const BENCHMARKS = [
            { name: 'Meal Deal', baseCostUSD: 5.7, img: 'https://i2-prod.hulldailymail.co.uk/article8387931.ece/ALTERNATES/s1200c/3_IMG_3757.jpg' },
            { name: 'Fancy Latte', baseCostUSD: 4.8, img: 'https://upload.wikimedia.org/wikipedia/commons/d/d8/Caffe_Latte_at_Pulse_Cafe.jpg' },
            { name: 'Pint of Lager', baseCostUSD: 8.2, img: 'https://www.yorkshireeveningpost.co.uk/jpim-static/image/2022/10/26/10/AdobeStock_512690395.jpeg?crop=3:2,smart&trim=&width=1200&auto=webp&quality=75' },
            { name: 'Cinema Ticket', baseCostUSD: 15.2, img: 'https://www.odeon.co.uk/media/s2iord0r/imax-seats.jpg?width=1200&height=630&v=1daa60ef9378810' },
            { name: 'Paperback Book', baseCostUSD: 19, img: 'https://blog.bookbaby.com/wp-content/uploads/2022/10/PaperbackVsHardcover_Feature.jpg' },
            { name: 'Basic Haircut', baseCostUSD: 25.3, img: 'https://d375139ucebi94.cloudfront.net/region2/gb/41289/cover/bbf96c6eab4948429eb02a5e8b9b88-the-barber-shop-3948c38077f54fa1bbaa80eb075095-booksy.jpeg' },
            { name: 'Takeaway Pizza', baseCostUSD: 35.4, img: 'https://tastewise.io/nitropack_static/aPohMRnUAesmicbodbFPKWssEccFSxfi/assets/images/optimized/rev-46865c4/tastewise.io/wp-content/uploads/2025/10/Dominos-Trending-Pizza_-Products.png' },
            { name: 'Vape Starter Kit', baseCostUSD: 57, img: 'https://greyhaze.co.uk/cdn/shop/articles/Best_Vape_Starter_Kits_33376535-c865-44b0-a5b3-15913f072f54.png?v=1761045205&width=1600' },
            { name: 'New Video Game', baseCostUSD: 76, img: 'https://i.ytimg.com/vi/M9iPrrA0T3g/maxresdefault.jpg' },
            { name: 'Nice Hoodie', baseCostUSD: 76, img: 'https://images.laguna-live.sd.co.uk/zoom/upload9223368955665736586.jpg?format=jpg&width=375' },
            { name: 'Gaming Keyboard', baseCostUSD: 126, img: 'https://cdn.mos.cms.futurecdn.net/iQQXB5JYodVP8rRBB5SVo9.jpg' },
            { name: 'Air Fryer', baseCostUSD: 152, img: 'https://images.immediate.co.uk/production/volatile/sites/30/2023/05/Philips-HD9280-91-Connected-XL-air-fryer-39a12b0.jpg?quality=90&resize=708,643' },
            { name: 'Coffee Machine', baseCostUSD: 190, img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQcT9P2KIFs8PZ7f40Ub3l9H9fkket0rUVf-w&s' },
            { name: 'Designer Trainers', baseCostUSD: 215, img: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=600&q=80' },
            { name: 'Designer Sunnies', baseCostUSD: 250, img: 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?auto=format&fit=crop&w=600&q=80' },
            { name: 'Nintendo Switch', baseCostUSD: 354, img: 'https://images.unsplash.com/photo-1578303512597-81e6cc155b3e?auto=format&fit=crop&w=600&q=80' },
            { name: 'iPad', baseCostUSD: 417, img: 'https://i.ebayimg.com/images/g/iDkAAOSwa8pkjcZI/s-l1200.jpg' },
            { name: 'Wireless Earbuds', baseCostUSD: 443, img: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=600&q=80' },
            { name: 'Short Weekend Break', baseCostUSD: 633, img: 'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?auto=format&fit=crop&w=600&q=80' },
            { name: 'Dyson Airwrap', baseCostUSD: 633, img: 'https://cdn.shopify.com/s/files/1/0630/5362/7541/files/123698-01_1_1.jpg?v=1764759868' },
            { name: 'Electric Scooter', baseCostUSD: 822, img: 'https://iridesd.com/wp-content/uploads/sites/4119/2020/11/tips-for-riding-a-scooter-as-a-beginner.jpg?w=1000&h=1000&zoom=2' },
            { name: 'USA Return Flight', baseCostUSD: 950, img: 'https://static0.simpleflyingimages.com/wordpress/wp-content/uploads/2025/03/hubs_thumbnail.jpg?q=49&fit=crop&w=360&h=240&dpr=2' },
            { name: 'iPhone 16 Pro', baseCostUSD: 1265, img: 'https://images.unsplash.com/photo-1616348436168-de43ad0db179?auto=format&fit=crop&w=600&q=80' },
            { name: 'Emergency Fund', baseCostUSD: 1265, img: 'https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?auto=format&fit=crop&w=600&q=80' },
            { name: 'MacBook Air M3', baseCostUSD: 1392, img: 'https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=600&q=80' },
            { name: 'Designer Handbag', baseCostUSD: 2531, img: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=600&q=80' },
            { name: 'Pro VR Headset', baseCostUSD: 3797, img: 'https://images.unsplash.com/photo-1622979135225-d2ba269cf1ac?auto=format&fit=crop&w=600&q=80' },
            { name: 'Pro Gamer PC Hub', baseCostUSD: 4430, img: 'https://images.unsplash.com/photo-1587202372775-e229f172b9d7?auto=format&fit=crop&w=600&q=80' },
            { name: 'Used VW Golf', baseCostUSD: 13924, img: 'https://images.unsplash.com/photo-1541899481282-d53bffe3c35d?auto=format&fit=crop&w=600&q=80' },
            { name: 'Rolex Submariner', baseCostUSD: 15822, img: 'https://www.marklittler.com/wp-content/uploads/2024/11/Submariner.jpg' },
            { name: 'Garden Office Pod', baseCostUSD: 22784, img: 'https://encrypted-tbn2.gstatic.com/shopping?q=tbn:ANd9GcQEJVdJh1ZWFcEcsXQ6Xn4CwnFwV-aCczsh1ThzcEwdFvdMujtHJnq3qbLMiSAPewVGOouwGed6f85t-tlBTzLIHwdbpXmqJi5Y9hZXEYw' },
            { name: 'Kitchen Renovation', baseCostUSD: 35443, img: 'https://images.unsplash.com/photo-1556911220-e15b29be8c8f?auto=format&fit=crop&w=600&q=80' },
            { name: 'Dream Wedding', baseCostUSD: 44303, img: 'https://images.unsplash.com/photo-1519225421980-715cb0215aed?auto=format&fit=crop&w=600&q=80' },
            { name: 'Tesla Model Y', baseCostUSD: 53152, img: 'https://media.autoexpress.co.uk/image/private/s--X-WVjvBW--/f_auto,t_content-image-full-desktop@1/v1679933008/autoexpress/2023/03/Tesla%20Model%20Y%20Long%20Range%20UK%20019_tswxae.jpg' },
            { name: 'UK House Deposit', baseCostUSD: 120000, img: 'https://assets.bwbx.io/images/users/iqjWHBFdfxIU/ivNQQaeUsWjw/v1/-1x-1.webp' },
            { name: 'London Flat Deposit', baseCostUSD: 180000, img: 'https://www.berkeleygroup.co.uk/-/media/migration/berkeley-group/berkeley-inspiration/london-with-amazing-views/london-dock-amazing-views.ashx?h=450&w=1185&rev=c827d26a50fc4e7e8b3f4a5f6a5abfd1&hash=0953AF2CB2212EA09A972834EA767274' },
            { name: 'Ferrari F8 Tribute', baseCostUSD: 316455, img: 'https://images.unsplash.com/photo-1592198084033-aade902d1aae?auto=format&fit=crop&w=600&q=80' },
            { name: 'Space Flight Trip', baseCostUSD: 759493, img: 'https://images.unsplash.com/photo-1517976487492-5750f3195933?auto=format&fit=crop&w=600&q=80' }
        ];

        const AnimatedValue = ({ value, format }) => {
            const [displayValue, setDisplayValue] = useState(0);
            const startTime = useRef(null);
            const startValue = useRef(0);
            const duration = 1000; 

            useEffect(() => {
                startValue.current = displayValue;
                startTime.current = null;
                let frame;
                const animate = (t) => {
                    if (!startTime.current) startTime.current = t;
                    const progress = t - startTime.current;
                    const ease = (x) => 1 - Math.pow(1 - x, 4);
                    if (progress < duration) {
                        setDisplayValue(startValue.current + (value - startValue.current) * ease(progress / duration));
                        frame = requestAnimationFrame(animate);
                    } else { setDisplayValue(value); }
                };
                frame = requestAnimationFrame(animate);
                return () => cancelAnimationFrame(frame);
            }, [value]);
            return <span>{format(displayValue)}</span>;
        };

        // --- NEW COMPONENT: Fixed Size Share Card (800x800 for Socials) ---
        // This component is rendered TWICE:
        // 1. Off-screen at full 800x800 resolution for image capture.
        // 2. Scaled down inside the modal for preview.
        const ShareCardContent = ({ calculations, habitCount, formatMoney }) => (
            <div className="w-[800px] h-[800px] relative bg-gradient-to-br from-indigo-600 via-purple-700 to-slate-900 flex flex-col items-center justify-center text-white p-16 shrink-0">
                 {/* Background Pattern - Pure CSS to prevent CORS/Loading issues */}
                 <div className="absolute inset-0 opacity-10 share-pattern"></div>
                 
                 {/* Abstract Shapes */}
                 <div className="absolute top-[-20%] left-[-20%] w-[500px] h-[500px] bg-pink-500 rounded-full blur-[120px] opacity-40"></div>
                 <div className="absolute bottom-[-20%] right-[-20%] w-[500px] h-[500px] bg-indigo-400 rounded-full blur-[120px] opacity-40"></div>

                 {/* Foreground Content */}
                 <div className="relative z-10 text-center w-full max-w-[650px] flex flex-col items-center">
                    
                    <div className="flex items-center gap-3 mb-6 bg-white/10 px-5 py-2 rounded-full backdrop-blur-none border border-white/20">
                         <div className="bg-white text-indigo-600 p-1 rounded">
                             <Icons.TrendingUp size={20} strokeWidth={4} />
                         </div>
                         <span className="text-sm font-black uppercase tracking-[0.2em]">SpendScope</span>
                    </div>
                    
                    <div className="text-xl font-bold uppercase tracking-widest opacity-80 mb-2">By reducing bad habits, I can save</div>
                    
                    <div className="text-[8rem] leading-none font-black tracking-tighter mb-6 drop-shadow-lg">
                        {formatMoney(calculations.yearly)}
                    </div>
                    
                    <div className="inline-flex items-center justify-center mt-12 bg-white text-indigo-900 px-10 py-3 rounded-full font-black text-xl leading-[1] text-center mb-12 shadow-xl -rotate-2">
                        <span>Every Single Year</span>
                    </div>





                    
                    <div className="grid grid-cols-2 gap-8 w-full">
                        <div className="bg-slate-900 rounded-[2rem] p-8 border border-white/0 shadow-xl">
                            <div className="text-sm uppercase font-bold opacity-60 mb-2 tracking-wider">Decade (Cash)</div>
                            <div className="text-4xl font-black tracking-tight text-emerald-400">
                            {formatMoney(calculations.tenYear)}
                            </div>

                        </div>
                        <div className="bg-slate-900 rounded-[2rem] p-8 border border-white/0 shadow-xl">
                            <div className="text-sm uppercase font-bold opacity-60 mb-2 tracking-wider">Cutting Back</div>
                            <div className="text-4xl font-black tracking-tight">{habitCount} <span className="text-2xl text-white/60">Habit{habitCount !== 1 ? 's' : ''}</span></div>
                        </div>
                    </div>
                 </div>
                 
                 <div className="absolute bottom-8 text-sm font-bold opacity-50 uppercase tracking-[0.3em]">
                    stefone.com/spendscope
                 </div>
            </div>
        );

        function App() {
            const [items, setItems] = useState([]);
            const [goals, setGoals] = useState([]);
            const [newItem, setNewItem] = useState({ name: '', cost: '', frequency: '1', period: 'day', category: 'Other' });
            
            // Goals State
            const [showGoalForm, setShowGoalForm] = useState(false);
            const [newGoal, setNewGoal] = useState({ name: '', target: '', image: '' });
            const [goalImageMode, setGoalImageMode] = useState('preset'); // preset, url, upload

            const [currencyCode, setCurrencyCode] = useState('GBP');
            const [darkMode, setDarkMode] = useState(true);
            const [loaded, setLoaded] = useState(false);
            const [powerTimeframe, setPowerTimeframe] = useState(1); 
            const [investmentRate, setInvestmentRate] = useState(7);
            
            // Sharing & Preview State
            const [showShareModal, setShowShareModal] = useState(false);
            const shareCardCaptureRef = useRef(null); // The invisible, high-res one
            const previewContainerRef = useRef(null); // The wrapper for the visible one
            const [previewScale, setPreviewScale] = useState(1);
            const [generatingImage, setGeneratingImage] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('spendscope_v13_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    // Migration Logic for new fields
                    const migratedItems = (data.items || []).map(i => ({
                        ...i,
                        category: i.category || 'Other',
                        reductionFactor: i.reductionFactor !== undefined ? i.reductionFactor : (i.active ? 1.0 : 0.0)
                    }));
                    setItems(migratedItems);
                    
                    // Migrate Goals to have image field if missing
                    const migratedGoals = (data.goals || []).map(g => ({
                        ...g,
                        image: g.image || ''
                    }));
                    setGoals(migratedGoals);

                    setCurrencyCode(data.currencyCode || 'GBP');
                    setPowerTimeframe(data.powerTimeframe || 1);
                    setInvestmentRate(data.investmentRate || 7);
                    if (data.darkMode !== undefined) setDarkMode(data.darkMode);
                }
                setLoaded(true);
            }, []);

            useEffect(() => {
                if (loaded) {
                    localStorage.setItem('spendscope_v13_data', JSON.stringify({ items, goals, currencyCode, darkMode, powerTimeframe, investmentRate }));
                    if (darkMode) document.documentElement.classList.add('dark');
                    else document.documentElement.classList.remove('dark');
                }
            }, [items, goals, currencyCode, darkMode, powerTimeframe, investmentRate, loaded]);

            // Calculate Preview Scale dynamically based on screen width
            useLayoutEffect(() => {
                const updateScale = () => {
                    if (showShareModal && previewContainerRef.current) {
                        const containerWidth = previewContainerRef.current.offsetWidth;
                        const cardWidth = 800; // Fixed width of our share card
                        // Scale down if container is smaller than card, otherwise 1 (or max 1)
                        const padding = 40; // visual padding
                        const newScale = Math.min((containerWidth - padding) / cardWidth, 0.6); // Cap at 0.6 so it's not huge on desktop
                        setPreviewScale(Math.max(newScale, 0.3)); // Min scale
                    }
                };

                updateScale();
                window.addEventListener('resize', updateScale);
                return () => window.removeEventListener('resize', updateScale);
            }, [showShareModal]);

            const calculations = useMemo(() => {
                let yearly = 0;
                let categoryTotals = {};
                
                // Init categories
                Object.keys(CATEGORIES).forEach(k => categoryTotals[k] = 0);

                items.forEach(i => {
                    // Savings = Cost * Freq * Period * ReductionFactor (Amount we DON'T spend)
                    const reduction = i.reductionFactor !== undefined ? i.reductionFactor : 1.0;
                    const saving = i.cost * i.frequency * PERIODS[i.period].multiplier * reduction;
                    yearly += saving;
                    
                    if (!categoryTotals[i.category]) categoryTotals[i.category] = 0;
                    categoryTotals[i.category] += saving;
                });
                
                // Investment returns calculation (adjustable)
                const rate = investmentRate / 100;
                const invest10 = rate > 0 ? yearly * ((Math.pow(1 + rate, 10) - 1) / rate) : yearly * 10;
                
                return { 
                    yearly, 
                    monthly: yearly / 12, 
                    weekly: yearly / 52,
                    daily: yearly / 365,
                    fiveYear: yearly * 5, 
                    tenYear: yearly * 10,
                    twentyYear: yearly * 20,
                    invest10: invest10,
                    categoryTotals
                };
            }, [items, investmentRate]);

            const formatMoney = (amount, precise = false) => {
                const config = CURRENCIES[currencyCode];
                return new Intl.NumberFormat(config.locale, {
                    style: 'currency', currency: currencyCode,
                    minimumFractionDigits: precise ? 2 : 0,
                    maximumFractionDigits: precise ? 2 : 0,
                }).format(amount);
            };

            const handleAddItem = (e) => {
                e.preventDefault();
                if (!newItem.name || !newItem.cost) return;
                setItems([{ id: Date.now(), ...newItem, cost: parseFloat(newItem.cost), frequency: parseFloat(newItem.frequency), reductionFactor: 1.0 }, ...items]);
                setNewItem({ name: '', cost: '', frequency: '1', period: 'day', category: 'Other' });
            };

            const handleAddGoal = (e) => {
                e.preventDefault();
                if (!newGoal.name || !newGoal.target) return;
                setGoals([...goals, { id: Date.now(), name: newGoal.name, target: parseFloat(newGoal.target), image: newGoal.image }]);
                setNewGoal({ name: '', target: '', image: '' });
                setGoalImageMode('preset');
                setShowGoalForm(false);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 500000) { // 500KB limit
                        alert("File too large. Please select an image under 500KB.");
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setNewGoal({ ...newGoal, image: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            const toggleReduction = (id, factor) => {
                setItems(items.map(item => item.id === id ? { ...item, reductionFactor: factor } : item));
            };

            const deleteItem = (id) => {
                setItems(items.filter(item => item.id !== id));
            };

            const deleteGoal = (id) => {
                setGoals(goals.filter(goal => goal.id !== id));
            };

            // Enhanced Share Logic
            const getShareText = () => {
                return `SpendScope Projection:\nI could save ${formatMoney(calculations.yearly)} per year and have ${formatMoney(calculations.invest10)} in 10 years by reducing my habits.\n\nCalculate yours at stefone.com/spendscope #SpendScope`;
            };

            const shareNative = async () => {
                const text = getShareText();
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'My SpendScope Projection',
                            text: text,
                        });
                    } catch (err) {
                        console.error('Error sharing:', err);
                    }
                } else {
                    alert("Native sharing not supported on this device.");
                }
            };

            const shareTwitter = () => {
                const text = encodeURIComponent(getShareText());
                window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
            };

            const shareFacebook = () => {
                const url = encodeURIComponent("https://stefone.com/spendscope");
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${encodeURIComponent(getShareText())}`, '_blank');
            };

            const shareReddit = () => {
                const url = encodeURIComponent("https://stefone.com/spendscope");
                const title = encodeURIComponent(getShareText());
                window.open(`https://reddit.com/submit?url=${url}&title=${title}`, '_blank');
            };

            const shareWhatsApp = () => {
                const text = encodeURIComponent(getShareText());
                window.open(`https://wa.me/?text=${text}`, '_blank');
            };

             const shareLinkedIn = () => {
                const url = encodeURIComponent("https://stefone.com/spendscope"); 
                window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
            };

            const shareEmail = () => {
                const subject = encodeURIComponent("My SpendScope Savings Projection");
                const body = encodeURIComponent(getShareText());
                window.location.href = `mailto:?subject=${subject}&body=${body}`;
            };

            const copyShareSummary = () => {
                navigator.clipboard.writeText(getShareText());
                alert("Summary copied to clipboard!");
            };

            const handleGenerateImage = async () => {
                if (!shareCardCaptureRef.current) return;
                setGeneratingImage(true);

                try {
                    // Capture the HIDDEN, FIXED-SIZE element (shareCardCaptureRef)
                    // This ensures the image is always 800x800 px regardless of device screen size

                    if (document.fonts && document.fonts.ready) {
                    await document.fonts.ready;
                    }
                    await new Promise(requestAnimationFrame);
                
                    const scale = 1; // super crisp export (makes a larger file)

                    const canvas = await html2canvas(shareCardCaptureRef.current, {
                        backgroundColor: null,
                        scale,
                        logging: false,
                        useCORS: true,
                        allowTaint: false,

                        scrollX: 0,
                        scrollY: 0,

                        // Force exact capture box
                        width: 800,
                        height: 800,
                        windowWidth: 800,
                        windowHeight: 800,
                    });



                    canvas.toBlob(async (blob) => {
                        const file = new File([blob], 'my-spendscope-projection.png', { type: 'image/png' });
                        
                        if (navigator.canShare && navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    files: [file],
                                    title: 'My SpendScope Stats',
                                    text: getShareText()
                                });
                            } catch (err) {
                                console.error("Share failed", err);
                                // Fallback to download if sharing fails
                                downloadImage(canvas);
                            }
                        } else {
                            downloadImage(canvas);
                        }
                        setGeneratingImage(false);
                    }, 'image/png');

                } catch (err) {
                    console.error("Image generation failed", err);
                    alert("Could not generate image. Please try again.");
                    setGeneratingImage(false);
                }
            };

            const downloadImage = (canvas) => {
                const link = document.createElement('a');
                link.download = 'spendscope-projection.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            };

            if (!loaded) return null;

            // Sorting categories for chart
            const sortedCategories = Object.entries(calculations.categoryTotals)
                .sort(([,a], [,b]) => b - a)
                .filter(([,val]) => val > 0);
            const maxCategoryVal = sortedCategories.length > 0 ? sortedCategories[0][1] : 1;

            return (
                <div className={`relative min-h-screen transition-all duration-700 ${darkMode ? 'bg-[#0b0f19] text-white' : 'bg-[#f8fafc] text-slate-900'} font-sans pb-20`}>
                    
                    <div className={`fixed inset-0 pointer-events-none transition-opacity duration-1000 ${darkMode ? 'opacity-30' : 'opacity-50'}`}>
                        <div className="absolute top-[-10%] left-[-10%] w-[50rem] h-[50rem] bg-indigo-600/10 rounded-full blur-[128px] animate-blob"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50rem] h-[50rem] bg-purple-600/10 rounded-full blur-[128px] animate-blob animation-delay-2000"></div>
                    </div>

                    <header className="sticky top-0 z-50 backdrop-blur-xl bg-white/70 dark:bg-[#0b0f19]/70 border-b border-slate-200 dark:border-white/10 px-4 sm:px-6 py-4">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-4">
                                <a href="/projects/" className="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-white/10 transition-all text-slate-500 dark:text-slate-300">
                                    <Icons.ArrowLeft size={20} />
                                </a>
                                <div className="flex items-center gap-2">
                                    <div className="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center text-white shadow-lg">
                                        <Icons.TrendingUp size={18} strokeWidth={3} />
                                    </div>
                                    <span className="text-xl font-black tracking-tighter uppercase font-sans hidden xs:inline">SpendScope Hub</span>
                                    <span className="text-xl font-black tracking-tighter uppercase font-sans xs:hidden">SpendScope</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 sm:gap-4">
                                <button onClick={() => setShowShareModal(true)} className="p-2 rounded-full hover:bg-indigo-500/10 text-indigo-500 transition-all">
                                    <Icons.Share2 size={20} />
                                </button>
                                <select 
                                    value={currencyCode} 
                                    onChange={(e) => setCurrencyCode(e.target.value)}
                                    className="bg-transparent font-bold text-sm outline-none cursor-pointer text-inherit"
                                >
                                    {Object.entries(CURRENCIES).map(([code, { symbol }]) => <option key={code} value={code} className="text-black">{code} ({symbol})</option>)}
                                </select>
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded-full dark:bg-white/5 border border-transparent dark:border-white/10">
                                    {darkMode ? <Icons.Sun size={20} /> : <Icons.Moon size={20} />}
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 pt-8 sm:pt-12 relative z-10">
                        
                        {/* Quick Add Bar */}
                        <div className="mb-12 animate-slide-up text-center lg:text-left">
                             <div className="flex items-center justify-center lg:justify-start gap-2 mb-4 px-1">
                                <span className="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 dark:text-indigo-300 opacity-60">Quick Add Items</span>
                             </div>
                             <div className="flex gap-4 overflow-x-auto pb-4 custom-scrollbar px-1 touch-pan-x">
                                {PRESETS.map((p) => (
                                    <button
                                        key={p.name}
                                        onClick={() => setNewItem({ name: p.name, cost: p.cost, frequency: p.frequency, period: p.period, category: p.category })}
                                        className="shrink-0 px-6 py-4 rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-slate-800/40 hover:border-indigo-500 transition-all shadow-sm flex items-center gap-3 group backdrop-blur-md active:scale-95"
                                    >
                                        <span className="text-2xl filter drop-shadow-sm group-hover:scale-110 transition-transform">{p.icon}</span>
                                        <span className="text-sm font-bold opacity-80 group-hover:opacity-100 whitespace-nowrap">{p.name}</span>
                                    </button>
                                ))}
                             </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-10 mb-20">
                            
                            <div className="lg:col-span-5 space-y-6 lg:space-y-8 order-2 lg:order-1">
                                {/* Customise Item Form */}
                                <div className="glass-panel p-6 sm:p-10 rounded-[2.5rem] sm:rounded-[3rem] relative overflow-hidden">
                                    <h3 className="text-lg font-black uppercase tracking-widest mb-8 flex items-center gap-3">
                                        <div className="w-10 h-10 rounded-2xl bg-indigo-500/10 flex items-center justify-center text-indigo-500">
                                            <Icons.Plus size={20} />
                                        </div>
                                        Customise Item
                                    </h3>
                                    <form onSubmit={handleAddItem} className="space-y-6">
                                        <input type="text" placeholder="Habit Name (e.g. Daily Coffee)" value={newItem.name} onChange={(e) => setNewItem({...newItem, name: e.target.value})} className="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 focus:ring-2 focus:ring-indigo-500 outline-none transition-all font-bold text-lg shadow-inner text-slate-900 dark:text-white" />
                                        <div className="grid grid-cols-3 gap-3 sm:gap-4">
                                            <div className="relative">
                                                <span className="absolute left-4 sm:left-5 top-5 text-slate-400 font-bold">{CURRENCIES[currencyCode].symbol}</span>
                                                <input type="number" step="0.01" value={newItem.cost} onChange={(e) => setNewItem({...newItem, cost: e.target.value})} className="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl pl-10 sm:pl-12 pr-4 sm:pr-6 py-5 font-bold text-lg shadow-inner text-slate-900 dark:text-white" />
                                            </div>
                                            <div className="relative">
                                                <span className="absolute left-4 sm:left-5 top-5 text-slate-400 font-bold text-sm">x</span>
                                                <input type="number" min="1" step="1" value={newItem.frequency} onChange={(e) => setNewItem({...newItem, frequency: e.target.value})} className="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl pl-8 sm:pl-10 pr-2 sm:pr-4 py-5 font-bold text-lg shadow-inner text-slate-900 dark:text-white" />
                                            </div>
                                            <select value={newItem.period} onChange={(e) => setNewItem({...newItem, period: e.target.value})} className="bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-2 sm:px-4 py-5 font-bold text-lg outline-none cursor-pointer text-slate-900 dark:text-white">
                                                {Object.entries(PERIODS).map(([k, { label }]) => <option key={k} value={k}>{label}</option>)}
                                            </select>
                                        </div>
                                        <select value={newItem.category} onChange={(e) => setNewItem({...newItem, category: e.target.value})} className="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 font-bold text-lg outline-none cursor-pointer text-slate-900 dark:text-white">
                                            {Object.keys(CATEGORIES).map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                        </select>
                                        <button type="submit" className="w-full impact-gradient py-6 rounded-3xl font-black text-white shadow-2xl shadow-indigo-500/40 hover:scale-[1.02] transition-all active:scale-95 uppercase tracking-widest text-lg font-sans">Save Habit</button>
                                    </form>
                                </div>

                                {/* Saved Habits List */}
                                {items.length > 0 && (
                                    <div className="glass-panel rounded-[2.5rem] sm:rounded-[3rem] overflow-hidden max-h-[600px] flex flex-col">
                                        <div className="p-6 sm:p-8 border-b border-slate-200 dark:border-white/10 flex justify-between items-center bg-slate-50/50 dark:bg-white/5">
                                            <h3 className="font-black uppercase tracking-widest text-xs opacity-50">Saved Habits</h3>
                                            <span className="text-[10px] font-black bg-indigo-500/10 px-3 py-1.5 rounded-full text-indigo-500 uppercase font-sans">
                                                {formatMoney(calculations.yearly)} Impact
                                            </span>
                                        </div>
                                        <div className="overflow-y-auto custom-scrollbar p-3 sm:p-4 space-y-3">
                                            {items.map(item => (
                                                <div key={item.id} className={`p-4 sm:p-5 rounded-3xl transition-all ${item.reductionFactor > 0 ? 'bg-white dark:bg-white/5 shadow-sm border border-slate-200 dark:border-white/5' : 'bg-slate-50 dark:bg-white/5 opacity-60'}`}>
                                                    <div className="flex items-center justify-between mb-3">
                                                        <div className="flex items-center gap-3 sm:gap-4">
                                                            <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-xl ${CATEGORIES[item.category].bg} bg-opacity-10 ${CATEGORIES[item.category].color}`}>
                                                                {CATEGORIES[item.category].icon}
                                                            </div>
                                                            <div>
                                                                <div className="font-bold text-base leading-tight truncate max-w-[120px] sm:max-w-[140px]">{item.name}</div>
                                                                <div className="text-[10px] uppercase font-black opacity-30 mt-1">
                                                                    {formatMoney(item.cost, true)} {item.frequency > 1 ? `x ${item.frequency}` : ''} / {item.period}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="flex items-center gap-2 sm:gap-3">
                                                            <div className="text-right">
                                                                <div className="text-sm font-black">{formatMoney(item.cost * item.frequency * PERIODS[item.period].multiplier * item.reductionFactor)}</div>
                                                                <div className="text-[8px] uppercase font-black opacity-40">Saved/Yr</div>
                                                            </div>
                                                            <button onClick={() => deleteItem(item.id)} className="p-2 text-rose-500 hover:bg-rose-500/10 rounded-xl transition-colors">
                                                                <Icons.Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Reduction Scenarios Toggles */}
                                                    <div className="bg-slate-100 dark:bg-black/20 p-1.5 rounded-xl flex justify-between gap-1">
                                                        {[0, 0.5, 0.75, 1].map(factor => (
                                                            <button 
                                                                key={factor}
                                                                onClick={() => toggleReduction(item.id, factor)}
                                                                className={`flex-1 py-1.5 rounded-lg text-[10px] font-black transition-all ${
                                                                    (item.reductionFactor === factor) 
                                                                        ? 'bg-white dark:bg-slate-700 shadow text-indigo-600 dark:text-white' 
                                                                        : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'
                                                                }`}
                                                            >
                                                                {factor === 0 ? 'KEEP' : `${factor * 100}%`}
                                                            </button>
                                                        ))}
                                                    </div>
                                                    <div className="text-center mt-1 text-[8px] font-bold uppercase tracking-widest opacity-30">Cutback Level</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Category Breakdown Chart */}
                                {items.length > 0 && (
                                    <div className="glass-panel p-6 sm:p-8 rounded-[2.5rem] sm:rounded-[3rem]">
                                        <h3 className="font-black uppercase tracking-widest text-xs opacity-50 mb-6 flex items-center gap-2">
                                            <Icons.BarChart2 size={14} /> Category Breakdown
                                        </h3>
                                        <div className="space-y-4">
                                            {sortedCategories.map(([cat, val]) => (
                                                <div key={cat} className="group">
                                                    <div className="flex justify-between text-[10px] font-bold mb-1 opacity-70">
                                                        <span>{cat}</span>
                                                        <span>{formatMoney(val)}</span>
                                                    </div>
                                                    <div className="h-2 w-full bg-slate-100 dark:bg-white/5 rounded-full overflow-hidden">
                                                        <div 
                                                            className={`h-full ${CATEGORIES[cat].bg} rounded-full transition-all duration-1000 ease-out`} 
                                                            style={{ width: `${(val / maxCategoryVal) * 100}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Enhanced Financial Impact Hub */}
                            <div className="lg:col-span-7 flex flex-col h-full gap-6 order-1 lg:order-2">
                                
                                {/* 1. Hero Annual Card */}
                                <div className="glass-panel p-6 sm:p-10 rounded-[2.5rem] sm:rounded-[3.5rem] relative overflow-hidden group flex-1 min-h-[300px] flex flex-col justify-center">
                                    <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-indigo-600/10 rounded-full blur-[100px] -mr-64 -mt-64"></div>
                                    <div className="absolute bottom-0 left-0 w-[300px] h-[300px] bg-pink-600/5 rounded-full blur-[80px] -ml-32 -mb-32"></div>
                                    
                                    <div className="relative z-10 text-center lg:text-left">
                                        <div className="flex items-center justify-center lg:justify-start gap-3 mb-6 opacity-50">
                                            <div className="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)] animate-pulse"></div>
                                            <h3 className="font-black uppercase tracking-[0.3em] text-[11px]">Total Annual Impact</h3>
                                        </div>
                                        
                                        <div className="text-[14vw] sm:text-[15vw] lg:text-[7rem] xl:text-[8.5rem] font-black tracking-tighter leading-none mb-4 bg-clip-text text-transparent bg-gradient-to-br from-slate-900 via-slate-600 to-slate-800 dark:from-white dark:via-slate-200 dark:to-slate-400 font-sans transform transition-transform hover:scale-[1.01] duration-700">
                                            <AnimatedValue value={calculations.yearly} format={(v) => formatMoney(v)} />
                                        </div>
                                        <div className="inline-block px-5 py-2 rounded-full bg-indigo-500/10 border border-indigo-500/20 text-indigo-500 dark:text-indigo-300 text-xs font-bold uppercase tracking-wider">
                                            Projected Cash Savings
                                        </div>
                                    </div>
                                </div>

                                {/* 2. Short Term Grid (Daily, Weekly, Monthly) */}
                                <div className="grid grid-cols-3 gap-3 lg:gap-6">
                                    {[
                                        { label: 'Daily', val: calculations.daily, icon: <Icons.Sun size={18} />, color: 'text-amber-500' },
                                        { label: 'Weekly', val: calculations.weekly, icon: <Icons.Calendar size={18} />, color: 'text-blue-500' },
                                        { label: 'Monthly', val: calculations.monthly, icon: <Icons.Moon size={18} />, color: 'text-indigo-500' }
                                    ].map((stat, i) => (
                                        <div key={i} className="glass-panel p-4 sm:p-6 rounded-[2rem] sm:rounded-[2.5rem] flex flex-col items-center lg:items-start text-center lg:text-left hover:bg-white/5 transition-colors">
                                            <div className={`mb-2 sm:mb-3 p-2 sm:p-2.5 rounded-2xl bg-white dark:bg-white/5 shadow-sm ${stat.color} w-fit`}>
                                                {stat.icon}
                                            </div>
                                            <div className="text-[9px] sm:text-[10px] uppercase font-black opacity-40 tracking-widest mb-1">{stat.label}</div>
                                            <div className="text-sm sm:text-lg lg:text-2xl font-black tracking-tight">
                                                <AnimatedValue value={stat.val} format={(v) => formatMoney(v, true)} />
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* 3. Long Term & Wealth Grid */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                                    
                                    {/* 5 Year Block */}
                                    <div className="glass-panel p-6 sm:p-8 rounded-[2.5rem] relative overflow-hidden group">
                                        <div className="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition-opacity">
                                            <Icons.Layers size={60} />
                                        </div>
                                        <div className="relative z-10">
                                            <div className="text-[10px] uppercase font-black opacity-40 tracking-widest mb-3">5 Years</div>
                                            <div className="text-3xl lg:text-4xl font-black tracking-tighter">
                                                <AnimatedValue value={calculations.fiveYear} format={(v) => formatMoney(v)} />
                                            </div>
                                            <div className="mt-2 text-[10px] font-bold opacity-30">Cash Accumulation</div>
                                        </div>
                                    </div>

                                    {/* 10 Year Block */}
                                    <div className="glass-panel p-6 sm:p-8 rounded-[2.5rem] relative overflow-hidden group">
                                         <div className="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition-opacity">
                                            <Icons.PieChart size={60} />
                                        </div>
                                        <div className="relative z-10">
                                            <div className="text-[10px] uppercase font-black opacity-40 tracking-widest mb-3">Decade</div>
                                            <div className="text-3xl lg:text-4xl font-black tracking-tighter text-indigo-500">
                                                <AnimatedValue value={calculations.tenYear} format={(v) => formatMoney(v)} />
                                            </div>
                                            <div className="mt-2 text-[10px] font-bold opacity-30">Cash Accumulation</div>
                                        </div>
                                    </div>

                                    {/* Adjustable Investment Block */}
                                    <div className="md:col-span-2 lg:col-span-1 bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-6 sm:p-8 rounded-[2.5rem] relative overflow-hidden shadow-xl shadow-indigo-500/20 flex flex-col justify-between">
                                        <div className="absolute inset-0 bg-white/10 backdrop-blur-[1px] mix-blend-overlay opacity-0 hover:opacity-100 transition-opacity"></div>
                                        
                                        <div className="relative z-10">
                                            <div className="flex items-center justify-between mb-2">
                                                <div className="flex items-center gap-2">
                                                    <Icons.Zap size={14} className="text-yellow-300 fill-yellow-300" />
                                                    <span className="text-[10px] uppercase font-black tracking-widest text-indigo-100">Wealth (10Y)</span>
                                                </div>
                                                <span className="text-[10px] font-bold bg-white/20 px-2 py-0.5 rounded-lg">{investmentRate}% Return</span>
                                            </div>
                                            <div className="text-3xl lg:text-3xl font-black tracking-tighter text-white drop-shadow-md mb-4">
                                                <AnimatedValue value={calculations.invest10} format={(v) => formatMoney(v)} />
                                            </div>
                                            
                                            {/* Investment Slider */}
                                            <div className="relative pt-2 h-8">
                                                {/* Background Track (Unfilled) */}
                                                <div className="absolute top-1/2 -translate-y-1/2 left-0 right-0 h-1.5 bg-black/20 rounded-full overflow-hidden z-0">
                                                     {/* Fill */}
                                                     <div className="h-full bg-white/90" style={{ width: `${((investmentRate - 3) / 7) * 100}%` }}></div>
                                                </div>
                                                
                                                {/* Input */}
                                                <input 
                                                    type="range" 
                                                    min="3" 
                                                    max="10" 
                                                    step="0.5"
                                                    value={investmentRate} 
                                                    onChange={(e) => setInvestmentRate(parseFloat(e.target.value))} 
                                                    className="w-full absolute top-1/2 -translate-y-1/2 z-10 appearance-none bg-transparent cursor-pointer"
                                                />
                                            </div>
                                            <div className="flex justify-between -mt-1 text-[8px] font-bold opacity-50">
                                                <span>3%</span>
                                                <span>Adjust Rate</span>
                                                <span>10%</span>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        {/* Custom Goals System */}
                        <div className="mb-20">
                            <div className="flex flex-col sm:flex-row sm:items-center justify-between mb-6 sm:mb-8 gap-4">
                                <h3 className="text-3xl font-black tracking-tighter font-sans flex items-center gap-3">
                                    <Icons.Target className="text-indigo-500" /> Your Custom Goals
                                </h3>
                                <button 
                                    onClick={() => setShowGoalForm(!showGoalForm)}
                                    className={`px-5 py-2.5 rounded-xl font-bold text-xs uppercase tracking-wider transition-all flex items-center justify-center gap-2 w-full sm:w-auto ${showGoalForm ? 'bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-slate-300' : 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30'}`}
                                >
                                    {showGoalForm ? <><Icons.X size={16} /> Cancel</> : <><Icons.Plus size={16} /> New Goal</>}
                                </button>
                            </div>
                            
                            {showGoalForm && (
                                <div className="glass-panel p-6 sm:p-8 rounded-[3rem] mb-10 animate-fade-in">
                                    <form onSubmit={handleAddGoal} className="flex flex-col gap-6">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <label className="text-[10px] uppercase font-black opacity-40 ml-4 mb-2 block tracking-widest">Goal Name</label>
                                                <input type="text" placeholder="e.g. Wedding Fund" value={newGoal.name} onChange={(e) => setNewGoal({...newGoal, name: e.target.value})} className="w-full bg-white/50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 font-bold text-base outline-none focus:ring-2 focus:ring-indigo-500 transition-all" />
                                            </div>
                                            <div>
                                                <label className="text-[10px] uppercase font-black opacity-40 ml-4 mb-2 block tracking-widest">Target ({CURRENCIES[currencyCode].symbol})</label>
                                                <input type="number" placeholder="5000" value={newGoal.target} onChange={(e) => setNewGoal({...newGoal, target: e.target.value})} className="w-full bg-white/50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 font-bold text-base outline-none focus:ring-2 focus:ring-indigo-500 transition-all" />
                                            </div>
                                        </div>

                                        {/* Image Selector Section */}
                                        <div className="bg-white/30 dark:bg-black/10 rounded-3xl p-6 border border-white/5">
                                            <div className="flex items-center gap-4 mb-4 overflow-x-auto pb-2 custom-scrollbar">
                                                <button type="button" onClick={() => setGoalImageMode('preset')} className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${goalImageMode === 'preset' ? 'bg-indigo-600 text-white' : 'hover:bg-black/5 dark:hover:bg-white/5'}`}>
                                                    <Icons.Image size={14} /> Presets
                                                </button>
                                                <button type="button" onClick={() => setGoalImageMode('url')} className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${goalImageMode === 'url' ? 'bg-indigo-600 text-white' : 'hover:bg-black/5 dark:hover:bg-white/5'}`}>
                                                    <Icons.Link size={14} /> URL
                                                </button>
                                                <button type="button" onClick={() => setGoalImageMode('upload')} className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${goalImageMode === 'upload' ? 'bg-indigo-600 text-white' : 'hover:bg-black/5 dark:hover:bg-white/5'}`}>
                                                    <Icons.Upload size={14} /> Upload
                                                </button>
                                            </div>

                                            <div className="min-h-[100px]">
                                                {goalImageMode === 'preset' && (
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                                        {GOAL_PRESETS.map((preset) => (
                                                            <button 
                                                                key={preset.name} 
                                                                type="button"
                                                                onClick={() => setNewGoal({ ...newGoal, image: preset.url })}
                                                                className={`relative aspect-video rounded-xl overflow-hidden group transition-all ${newGoal.image === preset.url ? 'ring-4 ring-indigo-500 ring-offset-2 dark:ring-offset-slate-900' : 'opacity-70 hover:opacity-100'}`}
                                                            >
                                                                <img src={preset.url} className="w-full h-full object-cover" alt={preset.name} />
                                                                <div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                                    <span className="text-[10px] font-bold text-white uppercase tracking-wider">{preset.name}</span>
                                                                </div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                )}

                                                {goalImageMode === 'url' && (
                                                    <div className="flex gap-4">
                                                        <input 
                                                            type="text" 
                                                            placeholder="Paste image URL here..." 
                                                            value={newGoal.image.startsWith('data:') ? '' : newGoal.image}
                                                            onChange={(e) => setNewGoal({ ...newGoal, image: e.target.value })}
                                                            className="flex-1 bg-white/50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
                                                        />
                                                    </div>
                                                )}

                                                {goalImageMode === 'upload' && (
                                                    <div className="border-2 border-dashed border-slate-300 dark:border-white/20 rounded-2xl p-8 text-center hover:border-indigo-500 transition-colors cursor-pointer relative group">
                                                        <input 
                                                            type="file" 
                                                            accept="image/*" 
                                                            onChange={handleImageUpload}
                                                            className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                                                        />
                                                        <div className="text-slate-400 group-hover:text-indigo-500 transition-colors">
                                                            <Icons.Upload className="mx-auto mb-2" />
                                                            <span className="text-xs font-bold uppercase tracking-wider">Click to Upload Image (Max 500kb)</span>
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Preview Area */}
                                                {newGoal.image && (
                                                    <div className="mt-4 p-4 bg-slate-100 dark:bg-white/5 rounded-2xl flex items-center gap-4">
                                                        <img src={newGoal.image} alt="Preview" className="w-16 h-16 rounded-lg object-cover bg-slate-300" />
                                                        <div className="text-xs opacity-60">
                                                            <span className="font-bold block text-sm opacity-100">Selected Image</span>
                                                            Looking good! This will cover your goal card.
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        <button type="submit" className="w-full py-4 rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-white font-black uppercase tracking-wider text-xs shadow-lg shadow-indigo-500/30 transition-all transform active:scale-95">
                                            Create Custom Goal
                                        </button>
                                    </form>
                                </div>
                            )}
                            
                            {/* Empty State Message */}
                            {goals.length === 0 && !showGoalForm && (
                                <div className="text-center p-8 border border-dashed border-slate-300 dark:border-white/10 rounded-[2rem] opacity-60">
                                    <p className="text-sm font-bold">No custom goals set yet. Click "New Goal" to start tracking.</p>
                                </div>
                            )}

                            {goals.length > 0 && (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
                                    {goals.map(goal => {
                                        // Calculate metrics
                                        const annualPace = calculations.yearly;
                                        const percentOfGoalPerYear = annualPace > 0 ? Math.min((annualPace / goal.target) * 100, 100) : 0;
                                        
                                        // Calculate Exact Date
                                        let dateString = '';
                                        if (annualPace > 0) {
                                            const daysToGoal = (goal.target / annualPace) * 365;
                                            const targetDate = new Date();
                                            targetDate.setDate(targetDate.getDate() + daysToGoal);
                                            dateString = targetDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                                        }
                                        
                                        // Visual Milestones
                                        const milestones = [25, 50, 75, 100];
                                        const achievedMilestone = milestones.reverse().find(m => percentOfGoalPerYear >= m) || 0;

                                        // Determine Text Colour based on image presence
                                        const hasImage = !!goal.image;
                                        const textColorClass = hasImage ? 'text-white' : '';
                                        const opacityClass = hasImage ? 'opacity-80' : 'opacity-50';

                                        return (
                                            <div key={goal.id} className="glass-panel p-6 sm:p-8 rounded-[2.5rem] relative overflow-hidden flex flex-col justify-between group min-h-[220px]">
                                                
                                                {/* Background Image logic */}
                                                {hasImage ? (
                                                    <>
                                                        <div className="absolute inset-0 z-0">
                                                            <img src={goal.image} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt={goal.name} />
                                                            <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-black/30"></div>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div className="absolute top-0 right-0 p-6 text-indigo-500 opacity-5 group-hover:opacity-10 transition-opacity">
                                                        <Icons.Target size={100} />
                                                    </div>
                                                )}
                                                
                                                {percentOfGoalPerYear >= 100 && (
                                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-20">
                                                         <div className="animate-confetti text-4xl">ðŸŽ‰</div>
                                                    </div>
                                                )}

                                                <div className="relative z-10">
                                                    <div className={`flex justify-between items-start mb-2 ${textColorClass}`}>
                                                        <h4 className="font-black text-xl tracking-tight drop-shadow-md">{goal.name}</h4>
                                                        <button onClick={() => deleteGoal(goal.id)} className={`${hasImage ? 'text-white/60 hover:text-rose-400' : 'text-slate-400 hover:text-rose-500'} transition-colors`}>
                                                            <Icons.X size={20} />
                                                        </button>
                                                    </div>
                                                    <div className={`text-sm font-bold mb-6 ${hasImage ? 'text-white/80' : 'opacity-60'}`}>Target: {formatMoney(goal.target)}</div>
                                                </div>

                                                <div className="relative z-10">
                                                    <div className={`flex justify-between text-[10px] font-black uppercase tracking-widest mb-2 ${hasImage ? 'text-white/70' : 'opacity-50'}`}>
                                                        <span>Annual Pace</span>
                                                        <span>{percentOfGoalPerYear.toFixed(0)}%</span>
                                                    </div>
                                                    <div className={`h-3 w-full rounded-full overflow-hidden mb-4 relative ${hasImage ? 'bg-white/20' : 'bg-slate-200 dark:bg-white/10'}`}>
                                                        <div 
                                                            className={`h-full rounded-full transition-all duration-1000 ${percentOfGoalPerYear >= 100 ? 'bg-gradient-to-r from-emerald-400 to-emerald-600' : 'bg-gradient-to-r from-indigo-500 to-purple-500'}`} 
                                                            style={{ width: `${percentOfGoalPerYear}%` }}
                                                        ></div>
                                                        {/* Milestone Markers */}
                                                        {[25, 50, 75].map(m => (
                                                            <div key={m} className="absolute top-0 bottom-0 w-px bg-white/30" style={{ left: `${m}%` }}></div>
                                                        ))}
                                                    </div>
                                                    <div className={`inline-block px-3 py-1 rounded-lg text-[10px] font-bold ${hasImage ? 'bg-white/20 text-white backdrop-blur-md' : 'bg-indigo-500/10 text-indigo-500'}`}>
                                                        {annualPace > 0 
                                                            ? `Achieve by ${dateString}` 
                                                            : 'Start saving to calculate'}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>

                        {/* Purchasing Power Gallery */}
                        <div className="mb-24">
                            <div className="flex flex-col md:flex-row items-end md:items-center justify-between mb-16 gap-8 px-2 sm:px-4">
                                <div>
                                    <h3 className="text-4xl sm:text-5xl font-black tracking-tighter mb-4 font-sans leading-none">The Reward Gallery</h3>
                                    <p className="opacity-40 font-bold text-base sm:text-lg leading-relaxed max-w-lg">Achievements projected over <span className="text-indigo-500 dark:text-indigo-400">{powerTimeframe} Year{powerTimeframe > 1 ? 's' : ''}</span>.</p>
                                </div>
                                <div className="flex bg-slate-200 dark:bg-slate-800 p-2 rounded-[2rem] shadow-inner border border-white/5 backdrop-blur-md overflow-x-auto w-full md:w-auto">
                                    {[1, 5, 10].map(yr => (
                                        <button key={yr} onClick={() => setPowerTimeframe(yr)} className={`flex-1 md:flex-none px-6 sm:px-10 py-4 rounded-[1.5rem] text-sm font-black transition-all ${powerTimeframe === yr ? 'bg-indigo-600 text-white shadow-lg scale-105' : 'opacity-40 hover:opacity-100'}`}>
                                            {yr}Y
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-10 px-0 sm:px-4">
                                {BENCHMARKS.map((b) => {
                                    const savedTotal = calculations.yearly * powerTimeframe;
                                    const costLocal = b.baseCostUSD * CURRENCIES[currencyCode].rate;
                                    const multRaw = costLocal > 0 ? savedTotal / costLocal : 0;
                                    
                                    const multDisplay = Math.floor(multRaw);
                                    const isEarned = multRaw >= 1;
                                    
                                    const progressPercentage = Math.min(Math.floor(multRaw * 100), 100);

                                    return (
                                        <div key={b.name} className={`group relative rounded-[2.5rem] sm:rounded-[3rem] overflow-hidden glass-panel transition-all duration-700 ${isEarned ? 'ring-2 ring-indigo-500/50 shadow-2xl scale-100' : 'opacity-50 grayscale hover:grayscale-0 hover:opacity-100 scale-[0.97] hover:scale-100'}`}>
                                            <div className="aspect-[4/3] overflow-hidden relative">
                                                <img 
                                                    src={b.img} 
                                                    alt={b.name}
                                                    className="product-image w-full h-full object-cover" 
                                                    onError={(e) => { e.target.src = 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?q=80&w=600&auto=format&fit=crop'; }}
                                                />
                                                
                                                {/* Achievement Multiplier Badge */}
                                                {multDisplay > 0 && (
                                                    <div className="absolute top-6 right-6 z-20">
                                                        <div className="glass-badge px-7 py-4 rounded-[1.5rem] font-black text-xl tracking-tighter transition-all duration-500 group-hover:scale-110 flex items-center justify-center min-w-[75px] text-white">

                                                            {multDisplay}x
                                                        </div>
                                                    </div>
                                                )}

                                                <div className="absolute inset-0 bg-gradient-to-t from-black/95 via-black/30 to-transparent opacity-80 group-hover:opacity-100 transition-opacity duration-500"></div>
                                                
                                                <div className="absolute bottom-8 left-8 right-8 text-white z-10">
                                                    <h4 className="font-black text-2xl leading-tight mb-2 drop-shadow-2xl font-sans">{b.name}</h4>
                                                    <div className="text-[10px] uppercase font-black opacity-60 tracking-[0.2em] mb-4">{formatMoney(costLocal)} EACH</div>
                                                    
                                                    {/* Subtle progress bar for tracking toward first unit */}
                                                    {!isEarned && (
                                                        <div className="w-full h-1.5 bg-white/10 rounded-full overflow-hidden backdrop-blur-xl border border-white/10 shadow-inner">
                                                            <div 
                                                                className="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-400 transition-all duration-1000 shadow-[0_0_15px_rgba(99,102,241,0.8)]"
                                                                style={{ width: `${progressPercentage}%` }}
                                                            />
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Share Modal - Completely Redesigned & Fixed Scroll */}
                        {showShareModal && (
                            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                                <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setShowShareModal(false)}></div>
                                <div className="relative bg-white dark:bg-slate-900 w-full max-w-lg rounded-[2.5rem] shadow-2xl animate-fade-in border border-white/10 flex flex-col max-h-[90vh]">
                                    
                                    {/* 1. INVISIBLE CAPTURE CONTAINER
                                        Positioned off-screen so user never sees it, but html2canvas can capture it at full resolution (800x800).
                                    */}
                                    <div style={{ position: 'fixed', left: 0, top: 0, opacity: 0, pointerEvents: 'none' }}>
                                        <div ref={shareCardCaptureRef}>
                                            <ShareCardContent 
                                                calculations={calculations} 
                                                habitCount={items.length} 
                                                formatMoney={(v) => formatMoney(v)} 
                                            />
                                        </div>
                                    </div>

                                    {/* MAIN SCROLLABLE WRAPPER: Ensures buttons are reachable on small screens */}
                                    <div className="overflow-y-auto custom-scrollbar flex-1 flex flex-col">
                                        
                                        {/* 2. VISIBLE PREVIEW CONTAINER */}
                                        <div className="relative bg-slate-100 dark:bg-black/40 shrink-0 flex items-center justify-center py-8" ref={previewContainerRef} style={{ height: 800 * previewScale + 64 }}>

                                             <div 
                                                style={{ 
                                                    width: 800, 
                                                    height: 800, 
                                                    transform: `scale(${previewScale})`,
                                                    transformOrigin: 'center center',
                                                }}
                                                className="flex-shrink-0 shadow-2xl rounded-3xl overflow-hidden"
                                             >
                                                <ShareCardContent 
                                                    calculations={calculations} 
                                                    habitCount={items.length} 
                                                    formatMoney={(v) => formatMoney(v)} 
                                                />
                                             </div>
                                            <button onClick={() => setShowShareModal(false)} className="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center bg-black/20 backdrop-blur-md rounded-full text-white/70 hover:text-white transition-colors"><Icons.X size={18} /></button>
                                        </div>

                                        {/* Action Buttons */}
                                        <div className="p-6 sm:p-8 space-y-6 bg-white dark:bg-slate-900 flex-1">
                                            <div className="flex flex-col sm:flex-row gap-3">
                                                <button 
                                                    onClick={handleGenerateImage} 
                                                    disabled={generatingImage}
                                                    className="flex-1 py-4 rounded-2xl bg-indigo-600 hover:bg-indigo-500 text-white font-bold flex items-center justify-center gap-2 transition-all shadow-lg shadow-indigo-500/20 active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed"
                                                >
                                                    {generatingImage ? (
                                                        <span className="animate-pulse">Generating...</span>
                                                    ) : (
                                                        <>
                                                            <Icons.Image size={20} />
                                                            <span>Share Image</span>
                                                        </>
                                                    )}
                                                </button>
                                                <button onClick={copyShareSummary} className="flex-1 py-4 rounded-2xl bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-900 dark:text-white font-bold flex items-center justify-center gap-2 transition-all active:scale-95">
                                                    <Icons.Copy size={18} /> Copy Text
                                                </button>
                                            </div>

                                            <div className="border-t border-slate-100 dark:border-white/5 pt-6">
                                                <p className="text-center text-[10px] uppercase font-bold opacity-40 mb-4 tracking-widest">Post to Socials</p>
                                                <div className="grid grid-cols-3 sm:grid-cols-5 gap-2 sm:gap-3">
                                                    <button onClick={shareFacebook} className="flex flex-col items-center justify-center gap-2 bg-[#1877F2]/10 hover:bg-[#1877F2]/20 text-[#1877F2] p-3 rounded-2xl transition-all h-20">
                                                        <Icons.Facebook size={24} />
                                                        <span className="text-[10px] font-bold">Facebook</span>
                                                    </button>
                                                    <button onClick={shareWhatsApp} className="flex flex-col items-center justify-center gap-2 bg-[#25D366]/10 hover:bg-[#25D366]/20 text-[#25D366] p-3 rounded-2xl transition-all h-20">
                                                        <Icons.MessageCircle size={24} />
                                                        <span className="text-[10px] font-bold">WhatsApp</span>
                                                    </button>
                                                    <button onClick={shareReddit} className="flex flex-col items-center justify-center gap-2 bg-[#FF4500]/10 hover:bg-[#FF4500]/20 text-[#FF4500] p-3 rounded-2xl transition-all h-20">
                                                        <Icons.Reddit size={24} />
                                                        <span className="text-[10px] font-bold">Reddit</span>
                                                    </button>
                                                    <button onClick={shareTwitter} className="flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-900 dark:text-white p-3 rounded-2xl transition-all h-20">
                                                        <Icons.Twitter size={24} />
                                                        <span className="text-[10px] font-bold">X / Tweet</span>
                                                    </button>
                                                    <button onClick={shareLinkedIn} className="flex flex-col items-center justify-center gap-2 bg-[#0077b5]/10 hover:bg-[#0077b5]/20 text-[#0077b5] p-3 rounded-2xl transition-all h-20">
                                                        <Icons.Linkedin size={24} />
                                                        <span className="text-[10px] font-bold">LinkedIn</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>