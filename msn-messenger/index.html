<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSN Messenger</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Fonts mimicking MSN style */
        @import url('https://fonts.googleapis.com/css2?family=Trebuchet+MS&display=swap');
        
        body {
            font-family: 'Trebuchet MS', 'Segoe UI', sans-serif;
            overflow: hidden; /* Prevent body scroll, handle in app */
        }

        /* Animations */
        @keyframes shake {
          0% { transform: translate(1px, 1px) rotate(0deg); }
          10% { transform: translate(-1px, -2px) rotate(-1deg); }
          20% { transform: translate(-3px, 0px) rotate(1deg); }
          30% { transform: translate(3px, 2px) rotate(0deg); }
          40% { transform: translate(1px, -1px) rotate(1deg); }
          50% { transform: translate(-1px, 2px) rotate(-1deg); }
          60% { transform: translate(-3px, 1px) rotate(0deg); }
          70% { transform: translate(3px, 1px) rotate(-1deg); }
          80% { transform: translate(-1px, -1px) rotate(1deg); }
          90% { transform: translate(1px, 2px) rotate(0deg); }
          100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .animate-shake {
          animation: shake 0.5s;
          animation-iteration-count: 1;
        }
        .msn-window {
          box-shadow: 0 0 0 1px rgba(0,0,0,0.3), 0 10px 40px rgba(0,0,0,0.5);
        }
        .msn-scrollbar::-webkit-scrollbar {
          width: 12px;
        }
        .msn-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
        }
        .msn-scrollbar::-webkit-scrollbar-thumb {
          background: #CDD6E0;
          border: 2px solid #f1f1f1;
          border-radius: 6px;
        }
        .msn-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #A0B0C0;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-transparent">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { 
          getAuth, 
          signInAnonymously, 
          onAuthStateChanged, 
          signInWithCustomToken 
        } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { 
          getFirestore, 
          collection, 
          addDoc, 
          onSnapshot, 
          query, 
          limit 
        } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- Global Access ---
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // --- Firebase Config ---
        // Ensure we handle the environment variable safely
        let firebaseConfig;
        let appId = 'default-app-id';
        try {
            firebaseConfig = JSON.parse(__firebase_config);
            if (typeof __app_id !== 'undefined') appId = __app_id;
        } catch (e) {
            console.warn("Firebase config not found. App will not function fully outside the preview environment.");
            firebaseConfig = {}; // Fallback to prevent crash, though auth will fail
        }

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Icons (Inline SVGs) ---
        // Replicating Lucide icons as simple components
        const IconBase = ({ children, size = 16, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const User = (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const Bell = (props) => <IconBase {...props}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></IconBase>;
        const Minus = (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Maximize = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/></IconBase>;
        const Smile = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></IconBase>;
        const Paperclip = (props) => <IconBase {...props}><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></IconBase>;
        const Phone = (props) => <IconBase {...props}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></IconBase>;
        const Video = (props) => <IconBase {...props}><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const Music = (props) => <IconBase {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></IconBase>;

        const MsnLogo = () => (
          <svg viewBox="0 0 100 100" className="w-8 h-8 drop-shadow-md">
            <path d="M50 20 C 30 20, 20 40, 20 60 C 20 80, 40 80, 50 60 C 60 80, 80 80, 80 60 C 80 40, 70 20, 50 20" fill="#00D2FF" opacity="0.8" />
            <circle cx="35" cy="45" r="5" fill="white" />
            <circle cx="65" cy="45" r="5" fill="white" />
            <path d="M45 65 Q 50 75 55 65" stroke="white" strokeWidth="3" fill="none" />
            <path d="M20 60 Q 10 50 20 40" stroke="#0099CC" strokeWidth="2" fill="none" />
            <path d="M80 60 Q 90 50 80 40" stroke="#0099CC" strokeWidth="2" fill="none" />
          </svg>
        );

        const MsnButterfly = () => (
          <svg viewBox="0 0 100 100" className="w-16 h-16">
            <path d="M50 50 L20 20 Q10 10 30 10 L50 40 Z" fill="#E63535" />
            <path d="M50 50 L80 20 Q90 10 70 10 L50 40 Z" fill="#2DA531" />
            <path d="M50 50 L20 80 Q10 90 30 90 L50 60 Z" fill="#0072C6" />
            <path d="M50 50 L80 80 Q90 90 70 90 L50 60 Z" fill="#F3A505" />
          </svg>
        );

        // --- Components ---

        const LoginScreen = ({ onJoin, isConnecting }) => {
          const [username, setUsername] = useState('');
          
          const handleSubmit = (e) => {
            e.preventDefault();
            if (username.trim()) onJoin(username);
          };

          return (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-[#00D2FF] to-[#0076D3] p-4 font-sans">
              <div className="bg-white p-1 rounded-lg shadow-2xl w-full max-w-sm border border-[#005194]">
                <div className="bg-gradient-to-b from-[#F3F9FF] to-[#D5EAF8] p-6 rounded relative overflow-hidden">
                  {/* Header */}
                  <div className="flex items-center justify-center mb-8">
                    <MsnButterfly />
                    <div className="ml-3">
                      <h1 className="text-2xl font-bold text-[#444] tracking-tight">Windows Live</h1>
                      <h2 className="text-xl text-[#666]">Messenger</h2>
                    </div>
                  </div>

                  {/* Form */}
                  <form onSubmit={handleSubmit} className="space-y-4 relative z-10">
                    <div className="space-y-1">
                      <label className="text-xs text-[#444] ml-1">Screen Name:</label>
                      <input 
                        type="text" 
                        value={username}
                        onChange={(e) => setUsername(e.target.value)}
                        className="w-full border border-[#89AEC6] p-1.5 outline-none focus:border-[#0072C6] text-sm bg-white shadow-inner"
                        placeholder="Type your nickname..."
                        autoFocus
                      />
                    </div>
                    
                    <div className="flex items-center space-x-2 text-xs text-[#555] mt-2">
                      <input type="checkbox" id="remember" className="rounded-none border-[#89AEC6]" />
                      <label htmlFor="remember">Remember me</label>
                    </div>

                    <div className="flex items-center space-x-2 text-xs text-[#555]">
                      <input type="checkbox" id="auto" className="rounded-none border-[#89AEC6]" />
                      <label htmlFor="auto">Sign me in automatically</label>
                    </div>

                    <button 
                      type="submit" 
                      disabled={isConnecting || !username.trim()}
                      className="w-full mt-6 bg-gradient-to-b from-[#F7FAFD] to-[#DCECF7] border border-[#85A6C3] text-[#444] py-1 px-4 hover:border-[#6C94B6] hover:bg-[#EBF4FB] active:bg-[#D4E8F5] transition-colors text-sm font-semibold shadow-sm disabled:opacity-50"
                    >
                      {isConnecting ? 'Signing in...' : 'Sign In'}
                    </button>
                    
                    <div className="text-center mt-4">
                       <span className="text-xs text-[#0066CC] hover:underline cursor-pointer">Forgot your password?</span>
                    </div>
                  </form>
                </div>
              </div>
              <div className="mt-4 text-white text-xs opacity-80">
                © 2009 Microsoft Corporation. All rights reserved.
              </div>
            </div>
          );
        };

        const ChatWindow = ({ currentUser, username, onLogout }) => {
          const [messages, setMessages] = useState([]);
          const [newMessage, setNewMessage] = useState('');
          const [isNudged, setIsNudged] = useState(false);
          const messagesEndRef = useRef(null);
          const chatContainerRef = useRef(null);

          const playSound = (type) => {
            try {
              const AudioContext = window.AudioContext || window.webkitAudioContext;
              if (!AudioContext) return;
              
              const ctx = new AudioContext();
              const osc = ctx.createOscillator();
              const gain = ctx.createGain();
              
              osc.connect(gain);
              gain.connect(ctx.destination);
              
              if (type === 'message') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
              } else if (type === 'nudge') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(150, ctx.currentTime + 0.1);
                osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                osc.start();
                osc.stop(ctx.currentTime + 0.4);
              }
            } catch (e) {
              console.error("Audio error", e);
            }
          };

          useEffect(() => {
            if (!currentUser) return;

            const q = query(
              collection(db, 'artifacts', appId, 'public', 'data', 'msn_messages'),
              limit(100)
            );

            const unsubscribe = onSnapshot(q, (snapshot) => {
              let msgs = [];
              snapshot.forEach((doc) => {
                msgs.push({ id: doc.id, ...doc.data() });
              });
              
              msgs.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
              
              const lastMsg = msgs[msgs.length - 1];
              if (lastMsg && lastMsg.type === 'nudge' && Date.now() - lastMsg.timestamp < 2000) {
                if (!isNudged) {
                  triggerNudge();
                }
              } else if (msgs.length > messages.length) {
                  if (messages.length > 0) playSound('message');
              }

              setMessages(msgs);
            }, (error) => {
              console.error("Error fetching messages:", error);
            });

            return () => unsubscribe();
          }, [currentUser]);

          const triggerNudge = () => {
            setIsNudged(true);
            playSound('nudge');
            setTimeout(() => setIsNudged(false), 500);
          };

          useEffect(() => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);

          const handleSend = async (e) => {
            e.preventDefault();
            if (!newMessage.trim()) return;

            try {
              await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'msn_messages'), {
                text: newMessage,
                sender: username,
                uid: currentUser.uid,
                timestamp: Date.now(),
                type: 'text'
              });
              setNewMessage('');
            } catch (err) {
              console.error("Error sending:", err);
            }
          };

          const sendNudge = async () => {
            try {
              await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'msn_messages'), {
                text: "sent a nudge!",
                sender: username,
                uid: currentUser.uid,
                timestamp: Date.now(),
                type: 'nudge'
              });
            } catch (err) {
              console.error("Error sending nudge:", err);
            }
          };

          return (
            <div className={`flex items-center justify-center min-h-screen bg-transparent p-2 md:p-8 font-sans ${isNudged ? 'animate-shake' : ''}`}>
              
              {/* Main Window Frame */}
              <div className="msn-window w-full max-w-4xl h-[85vh] flex flex-col bg-[#EBF4FB] rounded-lg overflow-hidden border border-[#58748F]">
                
                {/* Title Bar */}
                <div className="h-8 bg-gradient-to-r from-[#00579D] via-[#2F89C4] to-[#71B5E5] flex items-center justify-between px-2 select-none">
                  <div className="flex items-center space-x-2">
                    <MsnLogo />
                    <span className="text-white text-sm font-bold text-shadow-sm truncate">
                      {username} - Conversation
                    </span>
                    <span className="text-white/60 text-xs hidden sm:inline">&lt;{username}@hotmail.com&gt;</span>
                  </div>
                  <div className="flex items-center space-x-1">
                    <button className="p-0.5 hover:bg-white/20 rounded text-white"><Minus size={14}/></button>
                    <button className="p-0.5 hover:bg-white/20 rounded text-white"><Maximize size={14}/></button>
                    <button onClick={onLogout} className="p-0.5 hover:bg-[#E81123] rounded text-white transition-colors"><X size={14}/></button>
                  </div>
                </div>

                {/* Menu Bar */}
                <div className="h-6 bg-[#F5F6F7] border-b border-[#D8D8D8] flex items-center px-2 space-x-4 text-xs text-[#444]">
                  <span className="hover:bg-[#E5F3FB] px-1 cursor-pointer border border-transparent hover:border-[#70C0E7]">File</span>
                  <span className="hover:bg-[#E5F3FB] px-1 cursor-pointer border border-transparent hover:border-[#70C0E7]">Edit</span>
                  <span className="hover:bg-[#E5F3FB] px-1 cursor-pointer border border-transparent hover:border-[#70C0E7]">Actions</span>
                  <span className="hover:bg-[#E5F3FB] px-1 cursor-pointer border border-transparent hover:border-[#70C0E7]">Tools</span>
                  <span className="hover:bg-[#E5F3FB] px-1 cursor-pointer border border-transparent hover:border-[#70C0E7]">Help</span>
                </div>

                {/* Toolbar */}
                <div className="bg-gradient-to-b from-[#FCFCFC] to-[#E3EFFF] p-1 flex items-center border-b border-[#A2BCD4] space-x-2 overflow-x-auto">
                  <button className="flex items-center space-x-1 px-2 py-1 hover:bg-[#CDE3F3] border border-transparent hover:border-[#8FB9D6] rounded">
                    <User size={16} className="text-[#555]" />
                    <span className="text-xs text-[#333] whitespace-nowrap">Invite</span>
                  </button>
                   <button className="flex items-center space-x-1 px-2 py-1 hover:bg-[#CDE3F3] border border-transparent hover:border-[#8FB9D6] rounded">
                    <Paperclip size={16} className="text-[#555]" />
                    <span className="text-xs text-[#333] whitespace-nowrap">Files</span>
                  </button>
                  <button className="flex items-center space-x-1 px-2 py-1 hover:bg-[#CDE3F3] border border-transparent hover:border-[#8FB9D6] rounded">
                    <Video size={16} className="text-[#555]" />
                    <span className="text-xs text-[#333] whitespace-nowrap">Video</span>
                  </button>
                   <button className="flex items-center space-x-1 px-2 py-1 hover:bg-[#CDE3F3] border border-transparent hover:border-[#8FB9D6] rounded">
                    <Phone size={16} className="text-[#555]" />
                    <span className="text-xs text-[#333] whitespace-nowrap">Call</span>
                  </button>
                  <div className="h-4 w-px bg-gray-300 mx-1"></div>
                  <button className="flex items-center space-x-1 px-2 py-1 hover:bg-[#CDE3F3] border border-transparent hover:border-[#8FB9D6] rounded">
                    <Music size={16} className="text-[#555]" />
                    <span className="text-xs text-[#333] whitespace-nowrap">Activities</span>
                  </button>
                </div>

                {/* Main Content Area */}
                <div className="flex-1 flex overflow-hidden">
                  
                  {/* Left Sidebar (Avatar) */}
                  <div className="w-0 sm:w-32 bg-[#EBF4FB] border-r border-[#B5CBE0] flex flex-col items-center p-2 pt-4 hidden sm:flex">
                     <div className="w-24 h-24 bg-white border border-[#89AEC6] p-1 shadow-sm mb-2">
                        <img src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`} alt="Avatar" className="w-full h-full bg-gray-100" />
                     </div>
                     <span className="text-xs font-bold text-[#333] text-center w-full truncate">{username}</span>
                     <span className="text-[10px] text-[#666] flex items-center mt-1">
                       <div className="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                       Available
                     </span>
                  </div>

                  {/* Chat Area */}
                  <div className="flex-1 flex flex-col min-w-0 bg-white">
                    
                    {/* Conversation History */}
                    <div className="flex-1 overflow-y-auto p-4 msn-scrollbar bg-white" ref={chatContainerRef}>
                      <div className="text-center text-xs text-gray-400 mb-4 border-b border-gray-100 pb-2">
                        Use caution when sharing personal information.
                      </div>
                      
                      {messages.map((msg) => (
                        <div key={msg.id} className="mb-3 animate-fade-in">
                          {msg.type === 'nudge' ? (
                             <div className="font-bold text-[#888] text-sm italic">
                               — {msg.sender} sent a nudge! —
                             </div>
                          ) : (
                            <>
                              <div className="flex items-baseline space-x-2">
                                <span className={`text-sm font-bold ${msg.uid === currentUser.uid ? 'text-[#3E8019]' : 'text-[#00579D]'}`}>
                                  {msg.sender} says:
                                </span>
                              </div>
                              <div className="ml-2 text-[#333] font-sans text-sm break-words leading-tight" style={{fontFamily: "'Trebuchet MS', sans-serif"}}>
                                {msg.text}
                              </div>
                            </>
                          )}
                        </div>
                      ))}
                      <div ref={messagesEndRef} />
                    </div>

                    {/* Input Area Toolbar */}
                    <div className="h-8 bg-[#F0F0F0] border-t border-[#D6D6D6] flex items-center px-2 space-x-1">
                      <button className="p-1 hover:bg-[#DCECFC] rounded border border-transparent hover:border-[#8FB9D6]"><Smile size={16} className="text-[#555]"/></button>
                      <button onClick={sendNudge} className="p-1 hover:bg-[#DCECFC] rounded border border-transparent hover:border-[#8FB9D6] flex items-center space-x-1" title="Send a Nudge">
                         <Bell size={16} className="text-[#555]"/>
                         <span className="text-xs text-[#444] font-medium">Nudge</span>
                      </button>
                      <div className="h-4 w-px bg-gray-300 mx-1"></div>
                      <button className="px-2 py-0.5 bg-white border border-[#CCC] rounded text-xs font-serif italic text-black font-bold">A</button>
                      <div className="w-4 h-4 bg-[#FF0000] border border-[#999]"></div>
                    </div>

                    {/* Input Box */}
                    <div className="h-24 p-2 bg-white relative">
                      <form onSubmit={handleSend} className="h-full flex flex-col">
                        <textarea
                          value={newMessage}
                          onChange={(e) => setNewMessage(e.target.value)}
                          onKeyDown={(e) => {
                            if (e.key === 'Enter' && !e.shiftKey) {
                              handleSend(e);
                            }
                          }}
                          className="flex-1 w-full resize-none outline-none text-sm font-sans text-[#333] placeholder-gray-400"
                          placeholder="Type a message..."
                          style={{fontFamily: "'Trebuchet MS', sans-serif"}}
                        />
                        <div className="absolute bottom-2 right-2 flex space-x-2">
                          <button 
                            type="submit"
                            className="px-6 py-1 bg-gradient-to-b from-[#F9FCFF] to-[#D5E6F6] border border-[#85A6C3] rounded text-[#333] text-xs shadow-sm hover:border-[#6C94B6] active:bg-[#CDE3F3]"
                          >
                            Send
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                  
                  {/* Right Sidebar (Ads/Extras style) */}
                  <div className="w-0 md:w-40 bg-[#EBF4FB] border-l border-[#B5CBE0] hidden md:flex flex-col p-2 space-y-4">
                     <div className="w-full aspect-square border border-[#89AEC6] bg-white flex items-center justify-center p-2">
                         <div className="text-center">
                            <Users size={32} className="mx-auto text-[#0099CC] mb-2"/>
                            <p className="text-[10px] text-gray-500">Invite your friends to this conversation!</p>
                         </div>
                     </div>
                     
                     {/* Fake Ad Space */}
                     <div className="flex-1 bg-white border border-[#D1D1D1] flex items-end justify-center pb-2 overflow-hidden relative group cursor-pointer">
                         <div className="absolute inset-0 bg-gradient-to-br from-yellow-50 to-orange-100 opacity-50"></div>
                         <div className="z-10 text-center px-2">
                            <p className="text-[10px] text-[#888] uppercase tracking-wider mb-1">Sponsored</p>
                            <p className="text-xs font-bold text-[#E65A15] leading-tight">Get the new Smiley Pack!</p>
                            <button className="mt-2 text-[10px] bg-[#E65A15] text-white px-2 py-1 rounded-sm">Download</button>
                         </div>
                     </div>
                  </div>
                </div>

                {/* Status Bar */}
                <div className="h-6 bg-[#EBF4FB] border-t border-[#A2BCD4] flex items-center justify-between px-2 text-[10px] text-[#555]">
                  <span>Last message received at {new Date().toLocaleTimeString()}</span>
                  <span>Environment: Secure</span>
                </div>
              </div>
            </div>
          );
        };

        const App = () => {
          const [user, setUser] = useState(null);
          const [username, setUsername] = useState('');
          const [isConnecting, setIsConnecting] = useState(false);
          const [joined, setJoined] = useState(false);

          useEffect(() => {
            const initAuth = async () => {
              if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
              } else {
                await signInAnonymously(auth);
              }
            };
            initAuth();

            const unsubscribe = onAuthStateChanged(auth, (u) => {
              setUser(u);
            });
            return () => unsubscribe();
          }, []);

          const handleJoin = async (name) => {
            setIsConnecting(true);
            setTimeout(() => {
              setUsername(name);
              setJoined(true);
              setIsConnecting(false);
            }, 1500);
          };

          const handleLogout = () => {
            setJoined(false);
            setUsername('');
          };

          if (!user) {
            return (
              <div className="flex items-center justify-center h-screen text-gray-500 font-sans text-sm">
                Initializing Messenger Service...
              </div>
            );
          }

          if (!joined) {
            return <LoginScreen onJoin={handleJoin} isConnecting={isConnecting} />;
          }

          return (
            <ChatWindow 
              currentUser={user} 
              username={username}
              onLogout={handleLogout}
            />
          );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>